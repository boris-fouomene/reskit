# ðŸŒ Internationalization (i18n) - @resk/nativewind

> **Comprehensive localization system with automatic locale detection**

## ðŸ“– Overview

The @resk/nativewind i18n system provides robust internationalization support with automatic locale detection, plural forms, RTL support, and seamless integration across React Native and web platforms. Built on the proven @resk/core i18n foundation, it offers type-safe translations and dynamic locale switching.

---

## ðŸŽ¯ Core Features

### **ðŸŒ Automatic Locale Detection**
- Device locale detection on native platforms
- Browser language preferences on web
- Fallback locale chain with graceful degradation
- Dynamic locale switching with persistence

### **ðŸ“ Rich Translation Support**
- Pluralization rules for all languages
- Variable interpolation with type safety
- Nested translation keys with dot notation
- Context-aware translations

### **ðŸ”„ Dynamic Localization**
- Hot-swappable locales without restart
- Lazy loading of translation files
- Memory-efficient locale management
- Real-time UI updates on locale change

### **ðŸ“± Cross-Platform RTL Support**
- Automatic RTL layout detection
- Platform-specific RTL optimizations
- Bidirectional text rendering
- RTL-aware component styling

---

## ðŸš€ Getting Started

### **Basic Setup**

```tsx
import { useI18n } from '@resk/nativewind/i18n';
import { I18n } from '@resk/core/i18n';

// Basic usage with automatic locale detection
const MyComponent = () => {
  const i18n = useI18n();
  
  return (
    <View>
      <Text>{i18n.t('welcome.message')}</Text>
      <Text>{i18n.t('user.greeting', { name: 'John' })}</Text>
    </View>
  );
};

// With specific locale
const MyComponentWithLocale = () => {
  const i18n = useI18n(undefined, { 
    locale: 'fr-FR',
    useLocaleFromDevice: false 
  });
  
  return (
    <View>
      <Text>{i18n.t('welcome.message')}</Text>
    </View>
  );
};

// With custom locale detection
const MyComponentWithCustomDetection = () => {
  const i18n = useI18n(undefined, {
    useLocaleFromDevice: true,
    languages: [
      { languageCode: 'en', countryCode: 'US', languageTag: 'en-US', isRTL: false },
      { languageCode: 'ar', countryCode: 'SA', languageTag: 'ar-SA', isRTL: true }
    ]
  });
  
  return (
    <View>
      <Text>{i18n.t('welcome.message')}</Text>
    </View>
  );
};
```

### **Configuration Options**

```tsx
interface IUseI18nOptions {
  locale?: string;                    // Specific locale to use
  useLocaleFromDevice?: boolean;      // Auto-detect device locale
  languages?: II18nLocale[];          // Custom locale list
  locales?: string[];                 // Supported locale codes
}

interface II18nLocale {
  languageCode: string;               // ISO 639-1 language code (e.g., 'en')
  countryCode: string;                // ISO 3166-1 country code (e.g., 'US')
  languageTag: string;                // BCP 47 language tag (e.g., 'en-US')
  scriptCode?: string;                // ISO 15924 script code (e.g., 'Latn')
  isRTL: boolean;                     // Right-to-left text direction
}
```

---

## ðŸ“ Translation Management

### **Registering Translations**

```tsx
import { I18n } from '@resk/core/i18n';

// Register translations for multiple locales
I18n.RegisterTranslations({
  en: {
    welcome: {
      message: 'Welcome to our app!',
      subtitle: 'Enjoy your experience'
    },
    user: {
      greeting: 'Hello, {{name}}!',
      profile: 'User Profile',
      settings: 'Settings'
    },
    actions: {
      save: 'Save',
      cancel: 'Cancel',
      delete: 'Delete',
      edit: 'Edit'
    }
  },
  fr: {
    welcome: {
      message: 'Bienvenue dans notre application !',
      subtitle: 'Profitez de votre expÃ©rience'
    },
    user: {
      greeting: 'Bonjour, {{name}} !',
      profile: 'Profil utilisateur',
      settings: 'ParamÃ¨tres'
    },
    actions: {
      save: 'Enregistrer',
      cancel: 'Annuler',
      delete: 'Supprimer',
      edit: 'Modifier'
    }
  },
  'ar-SA': {
    welcome: {
      message: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§!',
      subtitle: 'Ø§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨ØªÙƒ'
    },
    user: {
      greeting: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {{name}}!',
      profile: 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ',
      settings: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'
    },
    actions: {
      save: 'Ø­ÙØ¸',
      cancel: 'Ø¥Ù„ØºØ§Ø¡',
      delete: 'Ø­Ø°Ù',
      edit: 'ØªØ¹Ø¯ÙŠÙ„'
    }
  }
});
```

### **Translation Usage Patterns**

```tsx
const TranslationExamples = () => {
  const i18n = useI18n();
  
  return (
    <View>
      {/* Simple translation */}
      <Text>{i18n.t('welcome.message')}</Text>
      
      {/* Translation with variables */}
      <Text>{i18n.t('user.greeting', { name: 'Alice' })}</Text>
      
      {/* Fallback with default value */}
      <Text>{i18n.t('unknown.key', {}, 'Default text')}</Text>
      
      {/* Nested translation keys */}
      <Text>{i18n.t('components.button.primary.label')}</Text>
      
      {/* Conditional translation */}
      <Text>
        {i18n.t(isLoggedIn ? 'actions.logout' : 'actions.login')}
      </Text>
    </View>
  );
};
```

---

## ðŸ“Š Pluralization Support

### **Plural Forms Configuration**

```tsx
// Register plural translations
I18n.RegisterTranslations({
  en: {
    items: {
      count: {
        zero: 'No items',
        one: 'One item',
        other: '{{count}} items'
      }
    },
    notifications: {
      unread: {
        zero: 'No unread notifications',
        one: 'One unread notification', 
        other: '{{count}} unread notifications'
      }
    }
  },
  fr: {
    items: {
      count: {
        zero: 'Aucun Ã©lÃ©ment',
        one: 'Un Ã©lÃ©ment',
        other: '{{count}} Ã©lÃ©ments'
      }
    }
  },
  ar: {
    items: {
      count: {
        zero: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±',
        one: 'Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯',
        two: 'Ø¹Ù†ØµØ±Ø§Ù†', // Arabic has dual form
        few: '{{count}} Ø¹Ù†Ø§ØµØ±',
        many: '{{count}} Ø¹Ù†ØµØ±',
        other: '{{count}} Ø¹Ù†ØµØ±'
      }
    }
  }
});
```

### **Using Plural Translations**

```tsx
const PluralExamples = () => {
  const i18n = useI18n();
  const [itemCount, setItemCount] = useState(0);
  const [unreadCount, setUnreadCount] = useState(5);
  
  return (
    <View>
      {/* Basic plural usage */}
      <Text>{i18n.t('items.count', { count: itemCount })}</Text>
      
      {/* Plural with badge */}
      <Badge 
        count={unreadCount}
        text={i18n.t('notifications.unread', { count: unreadCount })}
      />
      
      {/* Dynamic plural updates */}
      <Button onPress={() => setItemCount(prev => prev + 1)}>
        Add Item ({i18n.t('items.count', { count: itemCount + 1 })})
      </Button>
    </View>
  );
};
```

---

## ðŸ”„ Dynamic Locale Switching

### **Locale Switching Component**

```tsx
const LocaleSwitcher = () => {
  const i18n = useI18n();
  const [currentLocale, setCurrentLocale] = useState(i18n.getLocale());
  
  const availableLocales = [
    { code: 'en-US', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
    { code: 'fr-FR', name: 'FranÃ§ais', flag: 'ðŸ‡«ðŸ‡·' },
    { code: 'ar-SA', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', flag: 'ðŸ‡¸ðŸ‡¦' },
    { code: 'es-ES', name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' },
    { code: 'zh-CN', name: 'ä¸­æ–‡', flag: 'ðŸ‡¨ðŸ‡³' }
  ];
  
  const handleLocaleChange = async (localeCode: string) => {
    try {
      await i18n.setLocale(localeCode);
      setCurrentLocale(localeCode);
      
      // Optional: Persist locale preference
      await AsyncStorage.setItem('user_locale', localeCode);
    } catch (error) {
      console.error('Failed to change locale:', error);
    }
  };
  
  return (
    <Dropdown
      value={currentLocale}
      onValueChange={handleLocaleChange}
      data={availableLocales}
      renderItem={({ item }) => (
        <View className=\"flex-row items-center space-x-2 p-3\">
          <Text className=\"text-2xl\">{item.flag}</Text>
          <Text className=\"flex-1\">{item.name}</Text>
          {item.code === currentLocale && (
            <Icon name=\"check\" color=\"green\" />
          )}
        </View>
      )}
    >
      <Button variant=\"outline\" className=\"flex-row items-center space-x-2\">
        <Text>{availableLocales.find(l => l.code === currentLocale)?.flag}</Text>
        <Text>{i18n.t('settings.language')}</Text>
        <Icon name=\"chevron-down\" />
      </Button>
    </Dropdown>
  );
};
```

### **Automatic Locale Persistence**

```tsx
const LocaleProvider = ({ children }) => {
  const [isLoading, setIsLoading] = useState(true);
  const i18n = useI18n();
  
  useEffect(() => {
    const initializeLocale = async () => {
      try {
        // Try to restore saved locale
        const savedLocale = await AsyncStorage.getItem('user_locale');
        
        if (savedLocale && i18n.isLocaleSupported(savedLocale)) {
          await i18n.setLocale(savedLocale);
        } else {
          // Fall back to device locale or default
          const deviceLocales = await i18n.getDeviceLocales();
          const supportedLocale = deviceLocales.find(locale => 
            i18n.isLocaleSupported(locale.languageTag)
          );
          
          if (supportedLocale) {
            await i18n.setLocale(supportedLocale.languageTag);
          }
        }
      } catch (error) {
        console.error('Failed to initialize locale:', error);
      } finally {
        setIsLoading(false);
      }
    };
    
    initializeLocale();
  }, []);
  
  // Listen for locale changes and persist them
  useEffect(() => {
    const handleLocaleChange = async (newLocale: string) => {
      try {
        await AsyncStorage.setItem('user_locale', newLocale);
      } catch (error) {
        console.error('Failed to persist locale:', error);
      }
    };
    
    const unsubscribe = i18n.on('locale-changed', handleLocaleChange);
    return () => unsubscribe?.remove();
  }, [i18n]);
  
  if (isLoading) {
    return <LoadingScreen />;
  }
  
  return children;
};
```

---

## ðŸ“± RTL Support

### **RTL Detection and Layout**

```tsx
const RTLAwareComponent = () => {
  const i18n = useI18n();
  const isRTL = i18n.isRTL();
  const locale = i18n.getLocale();
  
  return (
    <View 
      className={`
        flex-row 
        ${isRTL ? 'flex-row-reverse' : 'flex-row'}
        p-4
      `}
    >
      {/* Text direction automatically handled */}
      <Text className={`
        flex-1 
        ${isRTL ? 'text-right' : 'text-left'}
      `}>
        {i18n.t('content.description')}
      </Text>
      
      {/* Icons and controls positioned correctly for RTL */}
      <Button 
        icon={isRTL ? 'arrow-left' : 'arrow-right'}
        className={isRTL ? 'mr-2' : 'ml-2'}
      >
        {i18n.t('actions.next')}
      </Button>
    </View>
  );
};

// RTL-aware navigation
const RTLNavigation = () => {
  const i18n = useI18n();
  const isRTL = i18n.isRTL();
  
  return (
    <Stack.Navigator
      screenOptions={{
        headerTitleAlign: 'center',
        animationTypeForReplace: 'push',
        // RTL slide animation
        cardStyleInterpolator: isRTL 
          ? CardStyleInterpolators.forHorizontalIOS 
          : CardStyleInterpolators.forHorizontalIOSReverse
      }}
    >
      {/* Navigation screens */}
    </Stack.Navigator>
  );
};
```

### **RTL-Aware Styling Utilities**

```tsx
// Create RTL-aware utility functions
const createRTLStyles = (i18n: I18n) => {
  const isRTL = i18n.isRTL();
  
  return {
    // Margin utilities
    marginStart: (value: number) => isRTL ? { marginRight: value } : { marginLeft: value },
    marginEnd: (value: number) => isRTL ? { marginLeft: value } : { marginRight: value },
    
    // Padding utilities  
    paddingStart: (value: number) => isRTL ? { paddingRight: value } : { paddingLeft: value },
    paddingEnd: (value: number) => isRTL ? { paddingLeft: value } : { paddingRight: value },
    
    // Flexbox utilities
    flexDirection: isRTL ? 'row-reverse' : 'row',
    textAlign: isRTL ? 'right' : 'left',
    
    // Border utilities
    borderStartWidth: (width: number) => isRTL ? { borderRightWidth: width } : { borderLeftWidth: width },
    borderEndWidth: (width: number) => isRTL ? { borderLeftWidth: width } : { borderRightWidth: width },
    
    // CSS class helpers
    classNames: {
      flexRow: isRTL ? 'flex-row-reverse' : 'flex-row',
      textAlign: isRTL ? 'text-right' : 'text-left',
      marginStart: (size: string) => isRTL ? `mr-${size}` : `ml-${size}`,
      marginEnd: (size: string) => isRTL ? `ml-${size}` : `mr-${size}`
    }
  };
};

// Usage in components
const RTLStyledComponent = () => {
  const i18n = useI18n();
  const rtl = createRTLStyles(i18n);
  
  return (
    <View className={`flex ${rtl.classNames.flexRow} p-4`}>
      <Icon name=\"star\" className={rtl.classNames.marginEnd('2')} />
      <Text className={`flex-1 ${rtl.classNames.textAlign}`}>
        {i18n.t('rating.label')}
      </Text>
    </View>
  );
};
```

---

## ðŸŽ¨ Component Integration

### **Localized Form Components**

```tsx
const LocalizedForm = () => {
  const i18n = useI18n();
  
  return (
    <Form>
      <TextInput
        label={i18n.t('form.email.label')}
        placeholder={i18n.t('form.email.placeholder')}
        error={i18n.t('form.email.error.invalid')}
        helperText={i18n.t('form.email.helper')}
      />
      
      <TextInput
        label={i18n.t('form.password.label')}
        placeholder={i18n.t('form.password.placeholder')}
        secureTextEntry
        error={i18n.t('form.password.error.weak')}
      />
      
      <Button variant=\"primary\" className=\"w-full\">
        {i18n.t('actions.submit')}
      </Button>
    </Form>
  );
};
```

### **Localized Date and Time**

```tsx
const LocalizedDateTime = ({ date }) => {
  const i18n = useI18n();
  const locale = i18n.getLocale();
  
  // Format date according to locale
  const formatDate = (date: Date) => {
    return new Intl.DateTimeFormat(locale, {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    }).format(date);
  };
  
  const formatTime = (date: Date) => {
    return new Intl.DateTimeFormat(locale, {
      hour: '2-digit',
      minute: '2-digit'
    }).format(date);
  };
  
  const formatRelativeTime = (date: Date) => {
    const rtf = new Intl.RelativeTimeFormat(locale, { numeric: 'auto' });
    const diffInMinutes = Math.round((date.getTime() - Date.now()) / 60000);
    
    if (Math.abs(diffInMinutes) < 60) {
      return rtf.format(diffInMinutes, 'minute');
    } else if (Math.abs(diffInMinutes) < 1440) {
      return rtf.format(Math.round(diffInMinutes / 60), 'hour');
    } else {
      return rtf.format(Math.round(diffInMinutes / 1440), 'day');
    }
  };
  
  return (
    <View>
      <Text>{formatDate(date)}</Text>
      <Text className=\"text-gray-500\">{formatTime(date)}</Text>
      <Text className=\"text-sm text-gray-400\">{formatRelativeTime(date)}</Text>
    </View>
  );
};
```

### **Localized Number and Currency**

```tsx
const LocalizedNumbers = ({ amount, currency = 'USD' }) => {
  const i18n = useI18n();
  const locale = i18n.getLocale();
  
  const formatCurrency = (amount: number, currency: string) => {
    return new Intl.NumberFormat(locale, {
      style: 'currency',
      currency: currency
    }).format(amount);
  };
  
  const formatNumber = (number: number) => {
    return new Intl.NumberFormat(locale).format(number);
  };
  
  const formatPercent = (value: number) => {
    return new Intl.NumberFormat(locale, {
      style: 'percent',
      minimumFractionDigits: 1
    }).format(value);
  };
  
  return (
    <View>
      <Text className=\"text-2xl font-bold\">
        {formatCurrency(amount, currency)}
      </Text>
      <Text>
        {i18n.t('finance.amount')}: {formatNumber(amount)}
      </Text>
      <Text>
        {i18n.t('finance.change')}: {formatPercent(0.15)}
      </Text>
    </View>
  );
};
```

---

## ðŸ”§ Advanced Features

### **Lazy Translation Loading**

```tsx
const LazyTranslationLoader = () => {
  const [loadedLocales, setLoadedLocales] = useState(new Set(['en']));
  const i18n = useI18n();
  
  const loadLocale = async (locale: string) => {
    if (loadedLocales.has(locale)) return;
    
    try {
      // Dynamically import translation file
      const translations = await import(`../translations/${locale}.json`);
      
      // Register the translations
      I18n.RegisterTranslations({
        [locale]: translations.default
      });
      
      setLoadedLocales(prev => new Set([...prev, locale]));
    } catch (error) {
      console.error(`Failed to load locale ${locale}:`, error);
    }
  };
  
  const switchLocale = async (locale: string) => {
    await loadLocale(locale);
    await i18n.setLocale(locale);
  };
  
  return (
    <LocaleSwitcher onLocaleChange={switchLocale} />
  );
};
```

### **Translation Validation**

```tsx
const TranslationValidator = () => {
  const i18n = useI18n();
  
  // Validate that all required translations exist
  const validateTranslations = (requiredKeys: string[]) => {
    const missingKeys = requiredKeys.filter(key => {
      try {
        const translation = i18n.t(key);
        return !translation || translation === key;
      } catch {
        return true;
      }
    });
    
    if (missingKeys.length > 0) {
      console.warn('Missing translations:', missingKeys);
    }
    
    return missingKeys;
  };
  
  useEffect(() => {
    const requiredKeys = [
      'welcome.title',
      'navigation.home',
      'actions.save',
      'actions.cancel'
    ];
    
    validateTranslations(requiredKeys);
  }, [i18n.getLocale()]);
  
  return null;
};
```

---

The i18n system in @resk/nativewind provides comprehensive internationalization support with automatic locale detection, RTL support, and seamless cross-platform compatibility. It ensures your application can reach global audiences with proper localization and cultural adaptations.

Next, I'll continue with the HTML elements documentation. Would you like me to proceed?
